<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Diary - DzungLayout</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;700&family=Playfair+Display:ital,wght@0,400;1,400&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['"Be Vietnam Pro"', 'sans-serif'], serif: ['Playfair Display', 'serif'] },
                    colors: { primary: '#1c1917', accent: '#a8a29e', paper: '#fafaf9', dark: '#0c0a09' }
                }
            }
        }
    </script>
    <style>
        body { overscroll-behavior-y: none; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #d6d3d1; }
        .prose h3 { font-family: 'Playfair Display', serif; font-size: 1.5rem; margin-top: 2rem; margin-bottom: 0.75rem; }
        .masonry-grid { column-count: 1; column-gap: 2rem; }
        @media (min-width: 768px) { .masonry-grid { column-count: 2; } }
        @media (min-width: 1024px) { .masonry-grid { column-count: 3; } }
        .masonry-item { break-inside: avoid; margin-bottom: 2rem; }
        .reveal { opacity: 0; transform: translateY(20px); transition: all 0.5s ease-out; }
        .reveal.active { opacity: 1; transform: translateY(0); }
    </style>
</head>
<body class="bg-paper text-primary dark:bg-dark dark:text-stone-200 transition-colors duration-500 font-sans antialiased min-h-screen">

    <!-- Navbar (Link back to Index) -->
    <nav class="fixed w-full z-50 bg-white/90 dark:bg-dark/90 backdrop-blur-sm border-b border-stone-200 dark:border-stone-800 transition-all"> 
        <div class="max-w-screen-2xl mx-auto px-6 py-4 flex justify-between items-center">
            <!-- Back to Home -->
            <a href="index.html" class="text-xl font-serif font-bold tracking-widest uppercase hover:text-accent transition">Dzung.</a>
            <div class="hidden md:flex space-x-8 text-xs font-bold uppercase tracking-widest text-stone-500">
                <a href="index.html" class="hover:text-primary dark:hover:text-white transition">Home</a>
                <a href="index.html#work" class="hover:text-primary dark:hover:text-white transition">Work</a>
                <span class="text-primary dark:text-white">Blog</span>
            </div>
            <button id="theme-toggle" class="text-lg hover:text-accent transition"><i class="fas fa-adjust"></i></button>
        </div>
    </nav>

    <!-- BLOG LIST VIEW -->
    <div id="blog-list-view" class="pt-32 pb-20 px-6 min-h-screen max-w-screen-2xl mx-auto">
        <div class="text-center mb-16">
            <p class="text-xs font-bold tracking-[0.3em] uppercase text-accent mb-4">Thoughts & Inspirations</p>
            <h1 class="text-5xl md:text-7xl font-serif italic mb-6">Visual Diary</h1>
            <div class="h-px w-16 bg-stone-300 dark:bg-stone-700 mx-auto"></div>
            <button id="btn-open-editor" class="mt-8 px-6 py-2 border border-dashed border-stone-400 text-stone-500 hover:text-primary dark:hover:text-white transition text-xs font-bold uppercase tracking-widest">
                <i class="fas fa-plus mr-2"></i> Write Story
            </button>
        </div>

        <!-- Filter -->
        <div class="flex flex-wrap justify-center gap-6 mb-12 text-sm font-bold uppercase tracking-widest text-stone-400">
            <button class="text-primary dark:text-white border-b border-primary dark:border-white pb-1" onclick="filterPosts('all')">All</button>
            <button class="hover:text-primary dark:hover:text-white transition" onclick="filterPosts('Tutorial')">Tutorials</button>
            <button class="hover:text-primary dark:hover:text-white transition" onclick="filterPosts('Inspiration')">Inspiration</button>
        </div>

        <!-- Grid -->
        <div id="blog-posts-container" class="masonry-grid"></div>
        
        <!-- Load More -->
        <div id="load-more-container" class="text-center py-10 hidden">
            <button id="btn-load-more" class="px-8 py-3 border border-stone-300 dark:border-stone-700 hover:bg-primary dark:hover:bg-white dark:hover:text-black transition text-xs font-bold uppercase tracking-widest">Load More</button>
        </div>
    </div>

    <!-- BLOG DETAIL VIEW (Overlay) -->
    <div id="blog-detail-view" class="fixed inset-0 z-[60] bg-white dark:bg-[#0c0a09] overflow-y-auto hidden opacity-0 transition-opacity duration-300">
        <div class="fixed top-0 left-0 w-full z-50 p-6">
            <button id="btn-close-detail" class="bg-white/10 backdrop-blur-md px-4 py-2 rounded-full border border-white/20 text-white text-sm font-bold uppercase tracking-widest hover:bg-white hover:text-black transition">
                <i class="fas fa-arrow-left mr-2"></i> Back
            </button>
        </div>
        <div class="h-[60vh] w-full relative">
            <div class="absolute inset-0 bg-gradient-to-b from-black/60 to-transparent z-10"></div>
            <img id="detail-image" src="" class="w-full h-full object-cover">
            <div class="absolute bottom-0 left-0 w-full p-8 md:p-20 z-20 bg-gradient-to-t from-[#0c0a09] to-transparent">
                <div class="max-w-4xl mx-auto">
                    <span id="detail-category" class="bg-accent text-white px-3 py-1 text-[10px] font-bold uppercase tracking-widest">Category</span>
                    <h1 id="detail-title" class="text-4xl md:text-6xl font-serif italic text-white mt-4 mb-2">Title</h1>
                    <p id="detail-date" class="text-sm text-stone-400 font-bold uppercase tracking-widest">Date</p>
                </div>
            </div>
        </div>
        <div class="max-w-3xl mx-auto px-6 py-16">
            <div id="detail-content" class="prose dark:prose-invert max-w-none prose-lg font-light leading-loose text-justify text-stone-700 dark:text-stone-300"></div>
        </div>
    </div>

    <!-- BLOG EDITOR (Modal) -->
    <div id="blog-editor-view" class="fixed inset-0 z-[70] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 hidden opacity-0 transition-opacity duration-300">
        <div class="w-full max-w-3xl bg-white dark:bg-[#1a1a1a] p-8 rounded-lg shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between mb-6"><h2 class="text-2xl font-serif">Write Story</h2><button id="btn-close-editor" class="text-red-500"><i class="fas fa-times"></i></button></div>
            <div class="space-y-4">
                <input id="editor-title" type="text" class="w-full bg-transparent border-b border-stone-300 py-2 text-xl focus:outline-none" placeholder="Title">
                <select id="editor-category" class="w-full bg-transparent border-b border-stone-300 py-2 dark:bg-[#1a1a1a]"><option>Inspiration</option><option>Tutorial</option><option>BTS</option></select>
                <input id="editor-image" type="text" class="w-full bg-transparent border-b border-stone-300 py-2" placeholder="Image URL">
                <textarea id="editor-content" rows="6" class="w-full bg-stone-50 dark:bg-black/30 p-4 font-mono text-sm" placeholder="Content (Markdown)..."></textarea>
                <button id="btn-save-post" class="w-full bg-primary text-white py-3 font-bold uppercase tracking-widest hover:opacity-90">Publish</button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. FULL DATA (HEAVY LOAD IS OK HERE) ---
        const initialPosts = [
            { id: 8, title: "The Psychology of Sound Design", category: "Tutorial", date: "Nov 15, 2024", image: "https://images.unsplash.com/photo-1598488035139-bdbb2231ce04?w=800", content: "Sound is 50% of the experience. In this breakdown, I explore how sub-bass frequencies can induce anxiety in horror sequences and how silence can be louder than an explosion.\n\n### Key Takeaways\n\n* **Diegetic vs. Non-diegetic:** When to blur the lines between what the characters hear and what the audience feels.\n* **The Shepard Tone:** Creating the illusion of infinite rising tension in your soundtracks." },
            { id: 7, title: "On Set: 'Neon Nights' Music Video", category: "BTS", date: "Nov 02, 2024", image: "https://images.unsplash.com/photo-1492691527719-9d1e07e534b4?w=800", content: "Shooting at night is always a challenge. For this project, we relied entirely on practical lighting using neon tubes and street lamps." },
            { id: 6, title: "Why I Shoot in 4:3 Aspect Ratio", category: "Inspiration", date: "Oct 28, 2024", image: "https://images.unsplash.com/photo-1533577116850-9cc66cad8a9b?w=800", content: "In a world of widescreen, the 4:3 aspect ratio feels intimate and claustrophobic in the best way possible." },
            { id: 5, title: "DaVinci Resolve Workflow for Speed", category: "Tutorial", date: "Oct 20, 2024", image: "https://images.unsplash.com/photo-1574717024653-61fd2cf4d44c?w=800", content: "Time is money. Over the years, I have optimized my node tree in DaVinci Resolve to grade faster without sacrificing quality." },
            { id: 4, title: "Finding Inspiration in Brutalist Architecture", category: "Inspiration", date: "Oct 15, 2024", image: "https://images.unsplash.com/photo-1486739985386-d4fae04ca6f7?w=800", content: "Concrete, sharp angles, and imposing structures. Brutalism teaches us about weight and presence." },
            { id: 1, title: "Color Grading 101: Teal & Orange", category: "Tutorial", date: "Oct 12, 2024", image: "https://images.unsplash.com/photo-1542204165-65bf26472b9b?w=800", content: "The **Teal and Orange** look is a classic for a reason. It uses complementary colors to make skin tones pop against the background." }
        ];

        let blogPosts = JSON.parse(localStorage.getItem('dzung_blog_posts_v4')) || initialPosts;
        localStorage.setItem('dzung_blog_posts_v4', JSON.stringify(blogPosts));

        // --- 2. RENDER LOGIC ---
        let visibleCount = 6;
        let currentFilter = 'all';

        function renderPosts() {
            const container = document.getElementById('blog-posts-container');
            container.innerHTML = '';
            
            let filtered = blogPosts.filter(p => currentFilter === 'all' || p.category.includes(currentFilter));
            filtered.sort((a,b) => b.id - a.id);
            
            const showing = filtered.slice(0, visibleCount);
            
            showing.forEach(post => {
                const el = document.createElement('div');
                el.className = 'masonry-item group cursor-pointer reveal';
                el.onclick = () => openDetail(post.id);
                el.innerHTML = `
                    <div class="relative overflow-hidden mb-4"><img src="${post.image}" loading="lazy" class="w-full object-cover transition duration-700 group-hover:scale-105"></div>
                    <span class="text-xs text-stone-400 font-serif italic mb-2 block">${post.date}</span>
                    <h3 class="text-2xl font-serif mb-2 group-hover:text-accent transition">${post.title}</h3>
                    <p class="text-sm text-stone-500 line-clamp-2">${post.content.replace(/[#*]/g,'')}</p>
                `;
                container.appendChild(el);
                setTimeout(() => el.classList.add('active'), 50);
            });

            // Load More Button
            const btn = document.getElementById('load-more-container');
            if (visibleCount >= filtered.length) btn.classList.add('hidden');
            else btn.classList.remove('hidden');
        }

        // --- 3. DETAIL VIEW & URL HANDLING ---
        const detailView = document.getElementById('blog-detail-view');
        
        function openDetail(id) {
            const post = blogPosts.find(p => p.id == id);
            if(!post) return;
            document.getElementById('detail-image').src = post.image;
            document.getElementById('detail-title').innerText = post.title;
            document.getElementById('detail-category').innerText = post.category;
            document.getElementById('detail-date').innerText = post.date;
            document.getElementById('detail-content').innerHTML = marked.parse(post.content);
            
            detailView.classList.remove('hidden');
            setTimeout(() => detailView.classList.remove('opacity-0'), 10);
            document.body.style.overflow = 'hidden';
            
            // Update URL without reload (optional, enables sharing)
            const url = new URL(window.location);
            url.searchParams.set('id', id);
            window.history.pushState({}, '', url);
        }

        function closeDetail() {
            detailView.classList.add('opacity-0');
            setTimeout(() => detailView.classList.add('hidden'), 300);
            document.body.style.overflow = '';
            // Remove ID from URL
            const url = new URL(window.location);
            url.searchParams.delete('id');
            window.history.pushState({}, '', url);
        }

        document.getElementById('btn-close-detail').onclick = closeDetail;

        // --- 4. INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            // Theme Init
            if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) document.documentElement.classList.add('dark');
            document.getElementById('theme-toggle').onclick = () => {
                document.documentElement.classList.toggle('dark');
                localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
            };

            renderPosts();
            
            document.getElementById('btn-load-more').onclick = () => { visibleCount += 6; renderPosts(); };

            // Check URL for ID (From Index Page)
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');
            if(id) openDetail(id);

            // Editor Logic (Simplified)
            const editor = document.getElementById('blog-editor-view');
            document.getElementById('btn-open-editor').onclick = () => { editor.classList.remove('hidden'); setTimeout(()=>editor.classList.remove('opacity-0'),10); };
            document.getElementById('btn-close-editor').onclick = () => { editor.classList.add('opacity-0'); setTimeout(()=>editor.classList.add('hidden'),300); };
            document.getElementById('btn-save-post').onclick = () => {
                const title = document.getElementById('editor-title').value;
                const content = document.getElementById('editor-content').value;
                if(title && content) {
                    blogPosts.unshift({
                        id: Date.now(), title, content, 
                        category: document.getElementById('editor-category').value,
                        image: document.getElementById('editor-image').value || 'https://images.unsplash.com/photo-1550751827-4bd374c3f58b?w=800',
                        date: new Date().toLocaleDateString('en-US')
                    });
                    localStorage.setItem('dzung_blog_posts_v4', JSON.stringify(blogPosts));
                    renderPosts();
                    document.getElementById('btn-close-editor').click();
                }
            };
        });

        function filterPosts(cat) {
            currentFilter = cat;
            visibleCount = 6;
            renderPosts();
        }
    </script>
</body>
</html>